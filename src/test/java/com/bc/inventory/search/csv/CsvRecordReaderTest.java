package com.bc.inventory.search.csv;

import com.bc.geometry.s2.S2WKTReader;
import com.google.common.geometry.S2Polygon;
import org.junit.Test;

import java.io.InputStream;
import java.util.List;

import static org.junit.Assert.*;

public class CsvRecordReaderTest {

    @Test
    public void testReadAllRecords() throws Exception {
        InputStream is = CsvRecordReaderTest.class.getResourceAsStream("/meris20050101_products_list.csv");
        List<CsvRecord> csvRecords = CsvRecordReader.readAllRecords(is);
        assertNotNull(csvRecords);
        assertEquals(14, csvRecords.size());
        CsvRecord first = csvRecords.get(0);
        assertEquals(1104540553000L, first.getStartTime());
        assertEquals(1104543171000L, first.getEndTime());
        assertEquals("MER_RR__1PNUPA20050101_004913_000026182033_00260_14843_3946.N1", first.getPath());
        assertNotNull(first.getS2Polygon());
        S2Polygon poly = (S2Polygon) new S2WKTReader().read("POLYGON ((141.15284729003906 56.64543533325195, 143.47738647460938 56.40227508544922, 145.76992797851562 56.11616516113281, 148.02627563476562 55.788185119628906, 150.24276733398438 55.419525146484375, 152.4160919189453 55.01136016845703, 154.54376220703125 54.565181732177734, 156.62362670898438 54.082420349121094, 158.6541290283203 53.56453323364258, 157.6580810546875 52.19601058959961, 156.720458984375 50.819725036621094, 155.83558654785156 49.43643569946289, 154.99844360351562 48.046817779541016, 154.20472717285156 46.65142822265625, 153.4503631591797 45.250816345214844, 152.73187255859375 43.84543228149414, 152.04612731933594 42.43569564819336, 151.3904571533203 41.02194595336914, 150.7622833251953 39.604515075683594, 150.1593475341797 38.183719635009766, 149.57968139648438 36.75979995727539, 149.02151489257812 35.33299255371094, 148.48313903808594 33.903533935546875, 147.9630584716797 32.47161865234375, 147.45994567871094 31.037412643432617, 146.97259521484375 29.601093292236328, 146.49986267089844 28.16281509399414, 146.04067993164062 26.72272300720215, 145.59413146972656 25.28095245361328, 145.1593780517578 23.837615966796875, 144.73558044433594 22.392831802368164, 144.322021484375 20.94671630859375, 143.9180145263672 19.49936866760254, 143.52293395996094 18.05087661743164, 143.13619995117188 16.60133934020996, 142.75723266601562 15.150846481323242, 142.38555908203125 13.69947338104248, 142.02069091796875 12.247299194335938, 141.66220092773438 10.794400215148926, 141.30963134765625 9.340847969055176, 140.9626007080078 7.886713027954102, 140.6207733154297 6.4320573806762695, 140.2837677001953 4.97694730758667, 139.95126342773438 3.5214438438415527, 139.62289428710938 2.0656049251556396, 139.2984161376953 0.609487771987915, 138.97752380371094 -0.8468509912490845, 138.659912109375 -2.303361654281616, 138.3453369140625 -3.759990930557251, 138.03355407714844 -5.2166900634765625, 137.72427368164062 -6.673412322998047, 137.41725158691406 -8.130109786987305, 137.11228942871094 -9.586738586425781, 136.80908203125 -11.043255805969238, 136.50746154785156 -12.49962043762207, 136.2071533203125 -13.955792427062988, 135.9079132080078 -15.411733627319336, 135.60955810546875 -16.867403030395508, 135.3118133544922 -18.32277488708496, 135.01443481445312 -19.777803421020508, 134.71719360351562 -21.232460021972656, 134.4198455810547 -22.686716079711914, 134.1221160888672 -24.140535354614258, 133.82374572753906 -25.59389305114746, 133.5244598388672 -27.04676055908203, 133.22393798828125 -28.499107360839844, 132.92190551757812 -29.950916290283203, 132.61801147460938 -31.402151107788086, 132.31192016601562 -32.85279846191406, 132.0032196044922 -34.302825927734375, 131.6915740966797 -35.752220153808594, 131.37648010253906 -37.20095443725586, 131.05751037597656 -38.649009704589844, 130.7340850830078 -40.09635925292969, 130.4056854248047 -41.542991638183594, 130.0716552734375 -42.98887634277344, 129.73129272460938 -44.433998107910156, 129.3837890625 -45.878326416015625, 129.0282745361328 -47.32185363769531, 128.66375732421875 -48.7645378112793, 128.28912353515625 -50.20635986328125, 127.90300750732422 -51.64727783203125, 127.50397491455078 -53.0872688293457, 127.09032440185547 -54.526283264160156, 126.66004943847656 -55.96427917480469, 126.21075439453125 -57.40119171142578, 125.73974609375 -58.83696746826172, 125.24376678466797 -60.271522521972656, 124.7188949584961 -61.704742431640625, 124.16029357910156 -63.136512756347656, 123.56227111816406 -64.56670379638672, 122.91773223876953 -65.99510192871094, 122.2177734375 -67.4214859008789, 121.45093536376953 -68.84554290771484, 120.60298156738281 -70.26685333251953, 119.65512084960938 -71.68490600585938, 118.58245086669922 -73.0989990234375, 117.35057830810547 -74.50811767578125, 115.91301727294922 -75.91094970703125, 114.20297241210938 -77.30547332763672, 112.12235260009766 -78.68877410888672, 109.51954650878906 -80.05622100830078, 106.15826416015625 -81.40042114257812, 101.64539337158203 -82.70867919921875, 95.30315399169922 -83.95777893066406, 85.92761993408203 -85.10191345214844, 71.6122817993164 -86.04934692382812, 50.6593132019043 -86.63037109375, 25.767555236816406 -86.64909362792969, 4.441431045532227 -86.095703125, -10.226971626281738 -85.16400146484375, -19.830684661865234 -84.02819061279297, -26.316648483276367 -82.78388977050781, -30.91254425048828 -81.47828674316406, -34.32768249511719 -80.13577270507812, -35.14910888671875 -79.7474365234375, -28.5727596282959 -79.23438262939453, -22.654634475708008 -78.59613800048828, -17.402624130249023 -77.85235595703125, -12.779767036437988 -77.02114868164062, -8.727309226989746 -76.11796569824219, -5.1746721267700195 -75.15611267089844, -2.0545144081115723 -74.14622497558594, 0.6947649717330933 -73.09686279296875, 1.9053711891174316 -73.33766174316406, 6.407419204711914 -74.12296295166016, 11.33045482635498 -74.8077163696289, 16.66448402404785 -75.37743377685547, 22.368322372436523 -75.81864929199219, 28.36931610107422 -76.11917114257812, 34.56296920776367 -76.269775390625, 40.82113265991211 -76.26502227783203, 47.00688171386719 -76.10557556152344, 52.99330520629883 -75.796630859375, 58.67753601074219 -75.34761810302734, 63.9874382019043 -74.77049255371094, 68.88626861572266 -74.07953643798828, 73.36417388916016 -73.288818359375, 77.4320068359375 -72.41172790527344, 81.11274719238281 -71.46025848388672, 84.43913269042969 -70.44544982910156, 87.44534301757812 -69.37657165527344, 90.16535949707031 -68.26156616210938, 92.63065338134766 -67.10697937011719, 94.8715591430664 -65.91859436035156, 96.91451263427734 -64.70111083984375, 98.78284454345703 -63.458465576171875, 100.49664306640625 -62.193931579589844, 102.0743637084961 -60.91037368774414, 103.53156280517578 -59.61015319824219, 104.88179779052734 -58.295265197753906, 106.13658142089844 -56.96738052368164, 107.30650329589844 -55.62799072265625, 108.40052032470703 -54.278350830078125, 109.42644500732422 -52.91953659057617, 110.39093780517578 -51.552452087402344, 111.30024719238281 -50.17792510986328, 112.15965270996094 -48.79667663574219, 112.97381591796875 -47.4093132019043, 113.74676513671875 -46.01636505126953, 114.48230743408203 -44.61833190917969, 115.1837158203125 -43.21563720703125, 115.8539047241211 -41.80866241455078, 116.4953842163086 -40.397727966308594, 117.11061096191406 -38.983154296875, 117.70166778564453 -37.565216064453125, 118.27046966552734 -36.14415740966797, 118.81865692138672 -34.72018814086914, 119.34786987304688 -33.29352951049805, 119.85948944091797 -31.864362716674805, 120.35481262207031 -30.432859420776367, 120.83497619628906 -28.999170303344727, 121.30108642578125 -27.563446044921875, 121.75411224365234 -26.125822067260742, 122.19498443603516 -24.686424255371094, 122.62447357177734 -23.245363235473633, 123.04338836669922 -21.802751541137695, 123.45242309570312 -20.35869598388672, 123.85224914550781 -18.913288116455078, 124.24342346191406 -17.46662139892578, 124.6265640258789 -16.018781661987305, 125.00218200683594 -14.569854736328125, 125.3707504272461 -13.119916915893555, 125.73273468017578 -11.669042587280273, 126.08856964111328 -10.217304229736328, 126.43866729736328 -8.764772415161133, 126.78341674804688 -7.311513900756836, 127.1231460571289 -5.857588768005371, 127.4582290649414 -4.403061866760254, 127.78897857666016 -2.947993040084839, 128.11570739746094 -1.4924379587173462, 128.43870544433594 -0.0364517495036125, 128.75827026367188 1.419909954071045, 129.0746612548828 2.876595973968506, 129.38815307617188 4.333556175231934, 129.69900512695312 5.790741443634033, 130.0074462890625 7.248104095458984, 130.31375122070312 8.705597877502441, 130.61813354492188 10.163179397583008, 130.92083740234375 11.620803833007812, 131.2220916748047 13.078432083129883, 131.52215576171875 14.536022186279297, 131.8212432861328 15.99353313446045, 132.1195831298828 17.450929641723633, 132.41741943359375 18.908172607421875, 132.71499633789062 20.365232467651367, 133.0125732421875 21.822067260742188, 133.31039428710938 23.27865219116211, 133.60870361328125 24.734943389892578, 133.90782165527344 26.190921783447266, 134.20797729492188 27.646556854248047, 134.509521484375 29.101810455322266, 134.81275939941406 30.55666160583496, 135.11801147460938 32.011085510253906, 135.4256591796875 33.465049743652344, 135.73609924316406 34.91852951049805, 136.0497283935547 36.37150573730469, 136.36703491210938 37.82394790649414, 136.6884765625 39.27583694458008, 137.01466369628906 40.72714614868164, 137.3461456298828 42.17784881591797, 137.68362426757812 43.62792205810547, 138.02783203125 45.07734298706055, 138.379638671875 46.526084899902344, 138.73995971679688 47.97411346435547, 139.10986328125 49.42140197753906, 139.4905548095703 50.867923736572266, 139.88348388671875 52.313629150390625, 140.29022216796875 53.75848388671875, 140.71261596679688 55.20243835449219, 141.15284729003906 56.64543533325195))");
        assertEquals(0, first.getS2Polygon().compareTo(poly));
    }
}